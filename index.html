<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Leads de Energía</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f4f4f9; }
        h1, h2 { color: #333; }
        #leads-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1em; margin-top: 2em;}
        .lead-card { background-color: white; border: 1px solid #ddd; border-radius: 8px; padding: 1em; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .lead-card h2 { margin-top: 0; color: #0056b3; }
        .lead-card p { margin: 0.5em 0; }
        .lead-card strong { color: #333; }
        input[type="text"], input[type="tel"] { width: 95%; padding: 8px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
        button { background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        .delete-btn { background-color: #dc3545; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Gestor de Leads de Energía</h1>

    <form id="add-lead-form" class="lead-card">
        <h2>Agregar Nuevo Lead</h2>
        <p><input type="text" id="businessName" placeholder="Nombre del Negocio (obligatorio)" required></p>
        <p><input type="text" id="dmFirstName" placeholder="Nombre del Contacto"></p>
        <p><input type="text" id="dmLastName" placeholder="Apellido del Contacto"></p>
        <p><input type="tel" id="dmPhone" placeholder="Teléfono (solo números y símbolos)"></p>
        <p><input type="text" id="fullAddress" placeholder="Dirección Completa"></p>
        <button type="submit">Guardar Lead</button>
    </form>

    <div id="status">
        <p>Cargando leads...</p>
    </div>

    <div id="leads-container">
        </div>

    <script type="module">
      // 1. IMPORTACIONES: Traemos las herramientas que necesitamos de Firebase (¡CORREGIDAS!)
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";
      import { getFirestore, collection, getDocs, addDoc, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";

      // 2. CONFIGURACIÓN: ¡¡¡IMPORTANTE!!! Pega tu configuración real aquí
      const firebaseConfig = {
        // Pega aquí el bloque de código de tu proyecto de Firebase
        // Ejemplo:
        // apiKey: "AIza...",
        // authDomain: "tu-proyecto.firebaseapp.com",
        // ...etc
      };

      // 3. INICIALIZACIÓN: Conectamos a Firebase y a la base de datos
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const leadsCollection = collection(db, "leads");

      // --- CÓDIGO PARA GUARDAR EL FORMULARIO (Actualizado con el campo de dirección) ---
      const addLeadForm = document.getElementById('add-lead-form');
      addLeadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const businessName = addLeadForm.businessName.value;
        const dmFirstName = addLeadForm.dmFirstName.value;
        const dmLastName = addLeadForm.dmLastName.value;
        const dmPhone = addLeadForm.dmPhone.value;
        const fullAddress = addLeadForm.fullAddress.value; // Capturamos la dirección
        try {
            await addDoc(leadsCollection, {
                businessName: businessName,
                dm: { firstName: dmFirstName, lastName: dmLastName, phone: dmPhone, email: "" },
                address: { fullAddress: fullAddress }, // Guardamos la dirección
                leadProgress: "Nuevo",
                createdAt: serverTimestamp()
            });
            addLeadForm.reset();
            CargarLeads();
        } catch
